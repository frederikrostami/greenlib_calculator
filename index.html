<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenLIB Black Mass Financial Calculator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            font-size: 16px;
            opacity: 0.95;
        }
        
        .content {
            padding: 30px;
        }
        
        .region-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .region-btn {
            flex: 1;
            min-width: 150px;
            padding: 15px 25px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
            font-weight: 600;
        }
        
        .region-btn:hover {
            border-color: #22c55e;
            transform: translateY(-2px);
        }
        
        .region-btn.active {
            background: #22c55e;
            color: white;
            border-color: #22c55e;
        }
        
        .scenario-section {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .scenario-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .us-scenario-toggle {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .scenario-btn {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
        }
        
        .scenario-btn:hover {
            border-color: #3b82f6;
        }
        
        .scenario-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .input-section {
            background: #f9fafb;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .section-header {
            font-size: 18px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #22c55e;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .input-group {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #374151;
            font-size: 13px;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border: 2px solid #e5e7eb;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #22c55e;
        }
        
        .input-help {
            font-size: 11px;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .calculate-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.3s;
            margin-bottom: 30px;
        }
        
        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(34, 197, 94, 0.4);
        }
        
        .results {
            display: none;
            margin-top: 30px;
        }
        
        .results.show {
            display: block;
        }
        
        .comparison-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border: 2px solid #22c55e;
            border-radius: 12px;
            padding: 25px;
        }
        
        .result-card.export {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-color: #ef4444;
        }
        
        .result-card h3 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #16a34a;
        }
        
        .result-card.export h3 {
            color: #dc2626;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            font-size: 14px;
        }
        
        .metric:last-child {
            border-bottom: none;
            font-weight: 700;
            font-size: 18px;
            padding-top: 15px;
            margin-top: 10px;
            border-top: 2px solid rgba(0,0,0,0.2);
        }
        
        .metric-label {
            color: #374151;
            font-weight: 500;
        }
        
        .metric-value {
            color: #16a34a;
            font-weight: 600;
        }
        
        .result-card.export .metric-value {
            color: #dc2626;
        }
        
        .breakdown-table {
            width: 100%;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .breakdown-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .breakdown-table th {
            background: #374151;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
        }
        
        .breakdown-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 13px;
        }
        
        .breakdown-table tr:hover {
            background: #f9fafb;
        }
        
        .savings-highlight {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-top: 30px;
        }
        
        .savings-highlight h2 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .savings-highlight .amount {
            font-size: 48px;
            font-weight: 700;
            margin: 15px 0;
        }
        
        .info-box {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .info-box h4 {
            color: #1e40af;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .info-box p {
            color: #1e40af;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .info-box.warning {
            background: #fef3c7;
            border-left-color: #f59e0b;
        }
        
        .info-box.warning h4,
        .info-box.warning p {
            color: #92400e;
        }
        
        .section-title {
            font-size: 22px;
            font-weight: 700;
            margin: 25px 0 15px 0;
            color: #1f2937;
            border-bottom: 3px solid #22c55e;
            padding-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔋 GreenLIB Financial Calculator</h1>
            <p>Payability-Based Black Mass Value Comparison</p>
        </div>
        
        <div class="content">
            <div class="region-selector">
                <button class="region-btn active" onclick="selectRegion('canada')">🇨🇦 Canadian Customer</button>
                <button class="region-btn" onclick="selectRegion('us')">🇺🇸 US Customer</button>
                <button class="region-btn" onclick="selectRegion('eu')">🇪🇺 European Customer</button>
            </div>
            
            <!-- Canadian Scenario -->
            <div id="canada-section" class="scenario-section active">
                <div class="info-box">
                    <h4>Canadian Domestic Processing</h4>
                    <p>Black mass processed domestically in Canada. Export route pays 55-70% on Ni/Co only. GreenLIB pays 90% on Ni/Co and recovers all other metals currently lost in export routes with no tariff exposure.</p>
                </div>
                
                <div class="input-section">
                    <div class="section-header">Commodity Prices (USD/tonne)</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Nickel Price</label>
                            <input type="number" id="ca-ni-price" value="15000" min="0">
                            <div class="input-help">$/t spot price</div>
                        </div>
                        <div class="input-group">
                            <label>Cobalt Price</label>
                            <input type="number" id="ca-co-price" value="42725" min="0">
                            <div class="input-help">$/t standard-grade</div>
                        </div>
                        <div class="input-group">
                            <label>Li₂CO₃ Price</label>
                            <input type="number" id="ca-li-price" value="7000" min="0">
                            <div class="input-help">$/t technical grade</div>
                        </div>
                        <div class="input-group">
                            <label>Graphite</label>
                            <input type="number" id="ca-graphite-price" value="400" min="0">
                            <div class="input-help">$/t pre-spheronization</div>
                        </div>
                        <div class="input-group">
                            <label>LiF (Lithium Fluoride)</label>
                            <input type="number" id="ca-lif-price" value="4000" min="0">
                            <div class="input-help">$/t technical grade</div>
                        </div>
                        <div class="input-group">
                            <label>Aluminum</label>
                            <input type="number" id="ca-al-price" value="1000" min="0">
                            <div class="input-help">$/t contained metal</div>
                        </div>
                        <div class="input-group">
                            <label>Copper</label>
                            <input type="number" id="ca-cu-price" value="5000" min="0">
                            <div class="input-help">$/t contained metal</div>
                        </div>
                    </div>
                </div>
                
                <div class="input-section">
                    <div class="section-header">Feed Composition (% dry basis)</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Cobalt (Co)</label>
                            <input type="number" id="ca-co-content" value="14" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Nickel (Ni)</label>
                            <input type="number" id="ca-ni-content" value="9.5" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Lithium (Li)</label>
                            <input type="number" id="ca-li-content" value="3.5" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Graphite (C)</label>
                            <input type="number" id="ca-c-content" value="35" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Fluorine (F)</label>
                            <input type="number" id="ca-f-content" value="0.5" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Aluminum (Al)</label>
                            <input type="number" id="ca-al-content" value="4" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Copper (Cu)</label>
                            <input type="number" id="ca-cu-content" value="1.3" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                    </div>
                </div>
                
                <div class="input-section">
                    <div class="section-header">Commercial Terms & Processing</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Volume (tonnes/year)</label>
                            <input type="number" id="ca-volume" value="10000" min="1">
                        </div>
                        <div class="input-group">
                            <label>Export Payability (Ni/Co only)</label>
                            <input type="number" id="ca-export-payability" value="55" min="0" max="100">
                            <div class="input-help">% of Ni/Co value paid (typically 55-70%)</div>
                        </div>
                        <div class="input-group">
                            <label>Export Transport Cost</label>
                            <input type="number" id="ca-export-transport" value="450" min="0">
                            <div class="input-help">$/t</div>
                        </div>
                        <div class="input-group">
                            <label>GreenLIB Payability</label>
                            <input type="number" id="ca-greenlib-payability" value="90" min="0" max="100">
                            <div class="input-help">% on Ni/Co purified oxide</div>
                        </div>
                        <div class="input-group">
                            <label>Processing Fee</label>
                            <input type="number" id="ca-processing-fee" value="1300" min="0">
                            <div class="input-help">$/t base charge</div>
                        </div>
                        <div class="input-group">
                            <label>Capacity Reservation</label>
                            <select id="ca-capacity-fee">
                                <option value="100">Standard (14 days) - $100/t</option>
                                <option value="120">Priority (10 days) - $120/t</option>
                                <option value="150">Dedicated (7 days) - $150/t</option>
                            </select>
                            <div class="input-help">Service lane & turnaround time</div>
                        </div>
                        <div class="input-group">
                            <label>GreenLIB Transport</label>
                            <input type="number" id="ca-transport" value="150" min="0">
                            <div class="input-help">$/t domestic</div>
                        </div>
                    </div>
                </div>
                
                <div class="input-section">
                    <div class="section-header">Recovery Rates (%)</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Ni/Co Recovery</label>
                            <input type="number" id="ca-nico-recovery" value="97" min="0" max="100">
                            <div class="input-help">Target ≥97%</div>
                        </div>
                        <div class="input-group">
                            <label>Li Recovery</label>
                            <input type="number" id="ca-li-recovery" value="90" min="0" max="100">
                            <div class="input-help">Target ≥90%</div>
                        </div>
                        <div class="input-group">
                            <label>Graphite Recovery</label>
                            <input type="number" id="ca-c-recovery" value="92" min="0" max="100">
                            <div class="input-help">Target ≥92%</div>
                        </div>
                        <div class="input-group">
                            <label>F Recovery</label>
                            <input type="number" id="ca-f-recovery" value="90" min="0" max="100">
                            <div class="input-help">Target ≥90%</div>
                        </div>
                        <div class="input-group">
                            <label>Al/Cu Recovery</label>
                            <input type="number" id="ca-alcu-recovery" value="95" min="0" max="100">
                            <div class="input-help">Target ≥95%</div>
                        </div>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateCanadian()">Calculate Financial Analysis</button>
                
                <div id="ca-results" class="results"></div>
            </div>
            
            <!-- US Scenarios -->
            <div id="us-section" class="scenario-section">
                <div class="us-scenario-toggle">
                    <button class="scenario-btn active" onclick="selectUSScenario(1)">
                        Scenario 1: Return to US<br><small>(Tolling + CUSMA Analysis)</small>
                    </button>
                    <button class="scenario-btn" onclick="selectUSScenario(2)">
                        Scenario 2: Sell in Canada<br><small>(Profit Sharing Model)</small>
                    </button>
                </div>
                
                <div id="us-scenario-1" class="us-scenario-content">
                    <div class="info-box">
                        <h4>Scenario 1: US Black Mass → Canada Processing → Return to US</h4>
                        <p>Material processed under tolling arrangement and returned to US. CUSMA qualification determines tariff exposure (0% if qualified, 35-50% if not). Export alternative pays 55-70% on Ni/Co only. GreenLIB pays 90% on Ni/Co and recovers all other metals currently lost in export routes.</p>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Commodity Prices (USD/tonne)</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>LME Nickel</label>
                                <input type="number" id="us1-ni-price" value="15000" min="0">
                                <div class="input-help">$/t spot price</div>
                            </div>
                            <div class="input-group">
                                <label>Fastmarkets Cobalt</label>
                                <input type="number" id="us1-co-price" value="42725" min="0">
                                <div class="input-help">$/t standard-grade</div>
                            </div>
                            <div class="input-group">
                                <label>Li₂CO₃</label>
                                <input type="number" id="us1-li-price" value="7000" min="0">
                                <div class="input-help">$/t technical grade</div>
                            </div>
                            <div class="input-group">
                                <label>Graphite</label>
                                <input type="number" id="us1-graphite-price" value="400" min="0">
                                <div class="input-help">$/t pre-spheronization</div>
                            </div>
                            <div class="input-group">
                                <label>LiF</label>
                                <input type="number" id="us1-lif-price" value="4000" min="0">
                                <div class="input-help">$/t technical grade</div>
                            </div>
                            <div class="input-group">
                                <label>Aluminum</label>
                                <input type="number" id="us1-al-price" value="1000" min="0">
                                <div class="input-help">$/t contained metal</div>
                            </div>
                            <div class="input-group">
                                <label>Copper</label>
                                <input type="number" id="us1-cu-price" value="5000" min="0">
                                <div class="input-help">$/t contained metal</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Feed Composition (% dry basis)</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>Cobalt (Co)</label>
                                <input type="number" id="us1-co-content" value="14" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Nickel (Ni)</label>
                                <input type="number" id="us1-ni-content" value="9.5" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Lithium (Li)</label>
                                <input type="number" id="us1-li-content" value="3.5" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Graphite (C)</label>
                                <input type="number" id="us1-c-content" value="35" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Fluorine (F)</label>
                                <input type="number" id="us1-f-content" value="0.5" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Aluminum (Al)</label>
                                <input type="number" id="us1-al-content" value="4" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Copper (Cu)</label>
                                <input type="number" id="us1-cu-content" value="1.3" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Commercial Terms & Processing</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>Volume (tonnes/year)</label>
                                <input type="number" id="us1-volume" value="10000" min="1">
                            </div>
                            <div class="input-group">
                                <label>Export Payability (Ni/Co only)</label>
                                <input type="number" id="us1-export-payability" value="55" min="0" max="100">
                                <div class="input-help">% of Ni/Co value paid (typically 55-70%)</div>
                            </div>
                            <div class="input-group">
                                <label>Export Transport Cost</label>
                                <input type="number" id="us1-export-transport" value="600" min="0">
                                <div class="input-help">$/t CIF Busan</div>
                            </div>
                            <div class="input-group">
                                <label>GreenLIB Payability</label>
                                <input type="number" id="us1-greenlib-payability" value="90" min="0" max="100">
                                <div class="input-help">% on Ni/Co purified oxide</div>
                            </div>
                            <div class="input-group">
                                <label>Processing Fee</label>
                                <input type="number" id="us1-processing-fee" value="1300" min="0">
                                <div class="input-help">$/t base charge</div>
                            </div>
                            <div class="input-group">
                                <label>Capacity Reservation</label>
                                <select id="us1-capacity-fee">
                                    <option value="100">Standard (14 days) - $100/t</option>
                                    <option value="120">Priority (10 days) - $120/t</option>
                                    <option value="150">Dedicated (7 days) - $150/t</option>
                                </select>
                                <div class="input-help">Service lane & turnaround time</div>
                            </div>
                            <div class="input-group">
                                <label>GreenLIB Transport</label>
                                <input type="number" id="us1-transport" value="250" min="0">
                                <div class="input-help">$/t US-Canada round-trip</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Recovery Rates (%)</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>Ni/Co Recovery</label>
                                <input type="number" id="us1-nico-recovery" value="97" min="0" max="100">
                                <div class="input-help">Target ≥97%</div>
                            </div>
                            <div class="input-group">
                                <label>Li Recovery</label>
                                <input type="number" id="us1-li-recovery" value="90" min="0" max="100">
                                <div class="input-help">Target ≥90%</div>
                            </div>
                            <div class="input-group">
                                <label>Graphite Recovery</label>
                                <input type="number" id="us1-c-recovery" value="92" min="0" max="100">
                                <div class="input-help">Target ≥92%</div>
                            </div>
                            <div class="input-group">
                                <label>F Recovery</label>
                                <input type="number" id="us1-f-recovery" value="90" min="0" max="100">
                                <div class="input-help">Target ≥90%</div>
                            </div>
                            <div class="input-group">
                                <label>Al/Cu Recovery</label>
                                <input type="number" id="us1-alcu-recovery" value="95" min="0" max="100">
                                <div class="input-help">Target ≥95%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Tariff & CUSMA Analysis</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>CUSMA Qualification</label>
                                <select id="us1-cusma">
                                    <option value="yes">Qualified (0% tariff)</option>
                                    <option value="no">Not Qualified</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Tariff Rate if Not Qualified (%)</label>
                                <input type="number" id="us1-tariff-rate" value="40" min="0" max="100">
                            </div>
                            <div class="input-group">
                                <label>Basel Compliance Cost</label>
                                <input type="number" id="us1-basel" value="75" min="0">
                                <div class="input-help">$/t import permits</div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="calculate-btn" onclick="calculateUS1()">Calculate Scenario 1</button>
                    
                    <div id="us1-results" class="results"></div>
                </div>
                
                <div id="us-scenario-2" class="us-scenario-content" style="display:none;">
                    <div class="info-box">
                        <h4>Scenario 2: US Black Mass → Canada Processing → Sold in Canada</h4>
                        <p>Processed materials sold to Canadian refineries/smelters with profit sharing. Zero tariff exposure. Export route pays 55-70% on Ni/Co only. GreenLIB pays 90% on Ni/Co and recovers all other metals currently lost in export routes.</p>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Commodity Prices (USD/tonne)</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>Nickel Price</label>
                                <input type="number" id="us2-ni-price" value="15000" min="0">
                                <div class="input-help">$/t spot price</div>
                            </div>
                            <div class="input-group">
                                <label>Cobalt Price</label>
                                <input type="number" id="us2-co-price" value="42725" min="0">
                                <div class="input-help">$/t standard-grade</div>
                            </div>
                            <div class="input-group">
                                <label>Li₂CO₃ Price</label>
                                <input type="number" id="us2-li-price" value="7000" min="0">
                                <div class="input-help">$/t technical grade</div>
                            </div>
                            <div class="input-group">
                                <label>Graphite</label>
                                <input type="number" id="us2-graphite-price" value="400" min="0">
                                <div class="input-help">$/t pre-spheronization</div>
                            </div>
                            <div class="input-group">
                                <label>LiF</label>
                                <input type="number" id="us2-lif-price" value="4000" min="0">
                                <div class="input-help">$/t technical grade</div>
                            </div>
                            <div class="input-group">
                                <label>Aluminum</label>
                                <input type="number" id="us2-al-price" value="1000" min="0">
                                <div class="input-help">$/t contained metal</div>
                            </div>
                            <div class="input-group">
                                <label>Copper</label>
                                <input type="number" id="us2-cu-price" value="5000" min="0">
                                <div class="input-help">$/t contained metal</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Feed Composition (% dry basis)</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>Cobalt (Co)</label>
                                <input type="number" id="us2-co-content" value="14" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Nickel (Ni)</label>
                                <input type="number" id="us2-ni-content" value="9.5" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Lithium (Li)</label>
                                <input type="number" id="us2-li-content" value="3.5" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Graphite (C)</label>
                                <input type="number" id="us2-c-content" value="35" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Fluorine (F)</label>
                                <input type="number" id="us2-f-content" value="0.5" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Aluminum (Al)</label>
                                <input type="number" id="us2-al-content" value="4" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                            <div class="input-group">
                                <label>Copper (Cu)</label>
                                <input type="number" id="us2-cu-content" value="1.3" min="0" max="100" step="0.1">
                                <div class="input-help">%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">GreenLIB Profit-Sharing Model</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>Volume (tonnes/year)</label>
                                <input type="number" id="us2-volume" value="10000" min="1">
                            </div>
                            <div class="input-group">
                                <label>GreenLIB Payability</label>
                                <input type="number" id="us2-greenlib-payability" value="90" min="0" max="100">
                                <div class="input-help">% on Ni/Co purified oxide</div>
                            </div>
                            <div class="input-group">
                                <label>Processing Fee</label>
                                <input type="number" id="us2-processing-fee" value="1200" min="0">
                                <div class="input-help">$/t (reduced with profit share)</div>
                            </div>
                            <div class="input-group">
                                <label>Capacity Reservation</label>
                                <select id="us2-capacity-fee">
                                    <option value="100">Standard (14 days) - $100/t</option>
                                    <option value="120">Priority (10 days) - $120/t</option>
                                    <option value="150">Dedicated (7 days) - $150/t</option>
                                </select>
                                <div class="input-help">Service lane & turnaround time</div>
                            </div>
                            <div class="input-group">
                                <label>Profit Share to US Customer</label>
                                <input type="number" id="us2-profit-share" value="30" min="0" max="100">
                                <div class="input-help">% of net margin</div>
                            </div>
                            <div class="input-group">
                                <label>Transport to Canada</label>
                                <input type="number" id="us2-transport" value="180" min="0">
                                <div class="input-help">$/t one-way</div>
                            </div>
                            <div class="input-group">
                                <label>Basel Import Cost</label>
                                <input type="number" id="us2-basel" value="75" min="0">
                                <div class="input-help">$/t</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Recovery Rates (%)</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>Ni/Co Recovery</label>
                                <input type="number" id="us2-nico-recovery" value="97" min="0" max="100">
                                <div class="input-help">Target ≥97%</div>
                            </div>
                            <div class="input-group">
                                <label>Li Recovery</label>
                                <input type="number" id="us2-li-recovery" value="90" min="0" max="100">
                                <div class="input-help">Target ≥90%</div>
                            </div>
                            <div class="input-group">
                                <label>Graphite Recovery</label>
                                <input type="number" id="us2-c-recovery" value="92" min="0" max="100">
                                <div class="input-help">Target ≥92%</div>
                            </div>
                            <div class="input-group">
                                <label>F Recovery</label>
                                <input type="number" id="us2-f-recovery" value="90" min="0" max="100">
                                <div class="input-help">Target ≥90%</div>
                            </div>
                            <div class="input-group">
                                <label>Al/Cu Recovery</label>
                                <input type="number" id="us2-alcu-recovery" value="95" min="0" max="100">
                                <div class="input-help">Target ≥95%</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="input-section">
                        <div class="section-header">Export Alternative</div>
                        <div class="input-grid">
                            <div class="input-group">
                                <label>Export Payability (Ni/Co only)</label>
                                <input type="number" id="us2-export-payability" value="55" min="0" max="100">
                                <div class="input-help">% of Ni/Co value paid (typically 55-70%)</div>
                            </div>
                            <div class="input-group">
                                <label>Export Transport Cost</label>
                                <input type="number" id="us2-export-transport" value="600" min="0">
                                <div class="input-help">$/t CIF Busan</div>
                            </div>
                        </div>
                    </div>
                    
                    <button class="calculate-btn" onclick="calculateUS2()">Calculate Scenario 2</button>
                    
                    <div id="us2-results" class="results"></div>
                </div>
            </div>
            
            <!-- European Scenario -->
            <div id="eu-section" class="scenario-section">
                <div class="info-box">
                    <h4>European Customer: EU Black Mass → Canada Processing</h4>
                    <p>Material shipped from EU to Canada. Export route pays 55-70% on Ni/Co only. GreenLIB pays 90% on Ni/Co and recovers all other metals currently lost in export routes. CETA provides zero-tariff access.</p>
                </div>
                
                <div class="input-section">
                    <div class="section-header">Commodity Prices (USD/tonne)</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>LME Nickel</label>
                            <input type="number" id="eu-ni-price" value="15000" min="0">
                            <div class="input-help">$/t spot price</div>
                        </div>
                        <div class="input-group">
                            <label>Fastmarkets Cobalt</label>
                            <input type="number" id="eu-co-price" value="42725" min="0">
                            <div class="input-help">$/t standard-grade</div>
                        </div>
                        <div class="input-group">
                            <label>Li₂CO₃ (Lithium Carbonate)</label>
                            <input type="number" id="eu-li-price" value="7000" min="0">
                            <div class="input-help">$/t technical grade</div>
                        </div>
                        <div class="input-group">
                            <label>Graphite</label>
                            <input type="number" id="eu-graphite-price" value="400" min="0">
                            <div class="input-help">$/t pre-spheronization</div>
                        </div>
                        <div class="input-group">
                            <label>LiF (Lithium Fluoride)</label>
                            <input type="number" id="eu-lif-price" value="4000" min="0">
                            <div class="input-help">$/t technical grade</div>
                        </div>
                        <div class="input-group">
                            <label>Aluminum</label>
                            <input type="number" id="eu-al-price" value="1000" min="0">
                            <div class="input-help">$/t contained metal</div>
                        </div>
                        <div class="input-group">
                            <label>Copper</label>
                            <input type="number" id="eu-cu-price" value="5000" min="0">
                            <div class="input-help">$/t contained metal</div>
                        </div>
                    </div>
                </div>
                
                <div class="input-section">
                    <div class="section-header">Feed Composition (% dry basis)</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Cobalt (Co)</label>
                            <input type="number" id="eu-co-content" value="14" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Nickel (Ni)</label>
                            <input type="number" id="eu-ni-content" value="9.5" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Lithium (Li)</label>
                            <input type="number" id="eu-li-content" value="3.5" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Graphite (C)</label>
                            <input type="number" id="eu-c-content" value="35" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Fluorine (F)</label>
                            <input type="number" id="eu-f-content" value="0.5" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Aluminum (Al)</label>
                            <input type="number" id="eu-al-content" value="4" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                        <div class="input-group">
                            <label>Copper (Cu)</label>
                            <input type="number" id="eu-cu-content" value="1.3" min="0" max="100" step="0.1">
                            <div class="input-help">%</div>
                        </div>
                    </div>
                </div>
                
                <div class="input-section">
                    <div class="section-header">Commercial Terms & Processing</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Volume (tonnes/year)</label>
                            <input type="number" id="eu-volume" value="10000" min="1">
                        </div>
                        <div class="input-group">
                            <label>Export Payability (Ni/Co only)</label>
                            <input type="number" id="eu-export-payability" value="55" min="0" max="100">
                            <div class="input-help">% of Ni/Co value paid (typically 55-70%)</div>
                        </div>
                        <div class="input-group">
                            <label>Export Transport Cost</label>
                            <input type="number" id="eu-export-transport" value="600" min="0">
                            <div class="input-help">$/t CIF Busan</div>
                        </div>
                        <div class="input-group">
                            <label>GreenLIB Payability</label>
                            <input type="number" id="eu-greenlib-payability" value="90" min="0" max="100">
                            <div class="input-help">% on Ni/Co purified oxide</div>
                        </div>
                        <div class="input-group">
                            <label>Processing Fee</label>
                            <input type="number" id="eu-processing-fee" value="1300" min="0">
                            <div class="input-help">$/t base charge</div>
                        </div>
                        <div class="input-group">
                            <label>Capacity Reservation</label>
                            <select id="eu-capacity-fee">
                                <option value="100">Standard (14 days) - $100/t</option>
                                <option value="120">Priority (10 days) - $120/t</option>
                                <option value="150">Dedicated (7 days) - $150/t</option>
                            </select>
                            <div class="input-help">Service lane & turnaround time</div>
                        </div>
                        <div class="input-group">
                            <label>GreenLIB Transport</label>
                            <input type="number" id="eu-greenlib-transport" value="200" min="0">
                            <div class="input-help">$/t EU-Canada round-trip</div>
                        </div>
                        <div class="input-group">
                            <label>Basel Import Cost</label>
                            <input type="number" id="eu-basel" value="0" min="0">
                            <div class="input-help">$/t import/export permits</div>
                        </div>
                    </div>
                </div>
                
                <div class="input-section">
                    <div class="section-header">Recovery Rates (%)</div>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Ni/Co Recovery</label>
                            <input type="number" id="eu-nico-recovery" value="97" min="0" max="100">
                            <div class="input-help">Target ≥97%</div>
                        </div>
                        <div class="input-group">
                            <label>Li Recovery</label>
                            <input type="number" id="eu-li-recovery" value="90" min="0" max="100">
                            <div class="input-help">Target ≥90%</div>
                        </div>
                        <div class="input-group">
                            <label>Graphite Recovery</label>
                            <input type="number" id="eu-c-recovery" value="92" min="0" max="100">
                            <div class="input-help">Target ≥92%</div>
                        </div>
                        <div class="input-group">
                            <label>F Recovery</label>
                            <input type="number" id="eu-f-recovery" value="90" min="0" max="100">
                            <div class="input-help">Target ≥90%</div>
                        </div>
                        <div class="input-group">
                            <label>Al/Cu Recovery</label>
                            <input type="number" id="eu-alcu-recovery" value="95" min="0" max="100">
                            <div class="input-help">Target ≥95%</div>
                        </div>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculateEU()">Calculate Financial Analysis</button>
                
                <div id="eu-results" class="results"></div>
            </div>
        </div>
    </div>

    <script>
        function selectRegion(region) {
            document.querySelectorAll('.region-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.scenario-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`${region}-section`).classList.add('active');
        }
        
        function selectUSScenario(scenario) {
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('us-scenario-1').style.display = scenario === 1 ? 'block' : 'none';
            document.getElementById('us-scenario-2').style.display = scenario === 2 ? 'block' : 'none';
        }
        
        function formatCurrency(amount) {
            return '$' + amount.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }
        
        function calculateCanadian() {
            // Get all commodity prices
            const niPrice = parseFloat(document.getElementById('ca-ni-price').value);
            const coPrice = parseFloat(document.getElementById('ca-co-price').value);
            const liPrice = parseFloat(document.getElementById('ca-li-price').value);
            const graphitePrice = parseFloat(document.getElementById('ca-graphite-price').value);
            const lifPrice = parseFloat(document.getElementById('ca-lif-price').value);
            const alPrice = parseFloat(document.getElementById('ca-al-price').value);
            const cuPrice = parseFloat(document.getElementById('ca-cu-price').value);
            
            // Get feed composition
            const niContent = parseFloat(document.getElementById('ca-ni-content').value) / 100;
            const coContent = parseFloat(document.getElementById('ca-co-content').value) / 100;
            const liContent = parseFloat(document.getElementById('ca-li-content').value) / 100;
            const cContent = parseFloat(document.getElementById('ca-c-content').value) / 100;
            const fContent = parseFloat(document.getElementById('ca-f-content').value) / 100;
            const alContent = parseFloat(document.getElementById('ca-al-content').value) / 100;
            const cuContent = parseFloat(document.getElementById('ca-cu-content').value) / 100;
            
            // Get commercial terms
            const volume = parseFloat(document.getElementById('ca-volume').value);
            const exportPayability = parseFloat(document.getElementById('ca-export-payability').value) / 100;
            const exportTransport = parseFloat(document.getElementById('ca-export-transport').value);
            const greenlibPayability = parseFloat(document.getElementById('ca-greenlib-payability').value) / 100;
            const processingFee = parseFloat(document.getElementById('ca-processing-fee').value);
            const capacityFee = parseFloat(document.getElementById('ca-capacity-fee').value);
            const transport = parseFloat(document.getElementById('ca-transport').value);
            
            // Get recovery rates
            const nicoRecovery = parseFloat(document.getElementById('ca-nico-recovery').value) / 100;
            const liRecovery = parseFloat(document.getElementById('ca-li-recovery').value) / 100;
            const cRecovery = parseFloat(document.getElementById('ca-c-recovery').value) / 100;
            const fRecovery = parseFloat(document.getElementById('ca-f-recovery').value) / 100;
            const alcuRecovery = parseFloat(document.getElementById('ca-alcu-recovery').value) / 100;
            
            // Conversion factors
            const liToLi2CO3 = 5.32;
            const fToLiF = 1.365;
            
            // EXPORT ROUTE (Ni/Co only at limited payability)
            const exportNiValue = niContent * exportPayability * niPrice;
            const exportCoValue = coContent * exportPayability * coPrice;
            const exportNet = exportNiValue + exportCoValue - exportTransport;
            
            // GREENLIB ROUTE (All metals at high payability)
            const greenlibNiValue = niContent * nicoRecovery * greenlibPayability * niPrice;
            const greenlibCoValue = coContent * nicoRecovery * greenlibPayability * coPrice;
            const greenlibLiValue = liContent * liRecovery * liToLi2CO3 * liPrice;
            const greenlibGraphiteValue = cContent * cRecovery * graphitePrice;
            const greenlibLiFValue = fContent * fRecovery * fToLiF * lifPrice;
            const greenlibAlValue = alContent * alcuRecovery * alPrice;
            const greenlibCuValue = cuContent * alcuRecovery * cuPrice;
            
            const greenlibGrossValue = greenlibNiValue + greenlibCoValue + greenlibLiValue + 
                                      greenlibGraphiteValue + greenlibLiFValue + greenlibAlValue + greenlibCuValue;
            const greenlibNet = greenlibGrossValue - processingFee - capacityFee - transport;
            
            const improvement = greenlibNet - exportNet;
            const improvementPct = (improvement / exportNet) * 100;
            const totalImprovement = improvement * volume;
            
            const resultsHTML = `
                <div class="comparison-cards">
                    <div class="result-card">
                        <h3>GreenLIB Domestic Processing</h3>
                        <div class="metric">
                            <span class="metric-label">Ni/Co Value (${(nicoRecovery * 100).toFixed(0)}% rec × ${(greenlibPayability * 100).toFixed(0)}%)</span>
                            <span class="metric-value">${formatCurrency(greenlibNiValue + greenlibCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Li₂CO₃ Value</span>
                            <span class="metric-value">${formatCurrency(greenlibLiValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Graphite Value</span>
                            <span class="metric-value">${formatCurrency(greenlibGraphiteValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">LiF + Al/Cu Value</span>
                            <span class="metric-value">${formatCurrency(greenlibLiFValue + greenlibAlValue + greenlibCuValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Gross Value</span>
                            <span class="metric-value">${formatCurrency(greenlibGrossValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Processing & Capacity</span>
                            <span class="metric-value">-${formatCurrency(processingFee + capacityFee)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Transport</span>
                            <span class="metric-value">-${formatCurrency(transport)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">NET REALIZATION</span>
                            <span class="metric-value">${formatCurrency(greenlibNet)}/t</span>
                        </div>
                    </div>
                    
                    <div class="result-card export">
                        <h3>Export Route</h3>
                        <div class="metric">
                            <span class="metric-label">Ni/Co Value (${(exportPayability * 100).toFixed(0)}%)</span>
                            <span class="metric-value">${formatCurrency(exportNiValue + exportCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Li₂CO₃ Value</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Other Metals</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Gross Value</span>
                            <span class="metric-value">${formatCurrency(exportNiValue + exportCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Transport</span>
                            <span class="metric-value">-${formatCurrency(exportTransport)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">NET REALIZATION</span>
                            <span class="metric-value">${formatCurrency(exportNet)}/t</span>
                        </div>
                    </div>
                </div>
                
                <div class="savings-highlight">
                    <h2>Value Enhancement with GreenLIB</h2>
                    <div class="amount">${formatCurrency(improvement)} per tonne</div>
                    <p>Total Annual Benefit: <strong>${formatCurrency(totalImprovement)}</strong> (${volume.toLocaleString()} tonnes)</p>
                    <p>Improvement: <strong>${improvementPct.toFixed(1)}%</strong></p>
                </div>
            `;
            
            document.getElementById('ca-results').innerHTML = resultsHTML;
            document.getElementById('ca-results').classList.add('show');
        }
        
        function calculateUS1() {
            // Get all commodity prices
            const niPrice = parseFloat(document.getElementById('us1-ni-price').value);
            const coPrice = parseFloat(document.getElementById('us1-co-price').value);
            const liPrice = parseFloat(document.getElementById('us1-li-price').value);
            const graphitePrice = parseFloat(document.getElementById('us1-graphite-price').value);
            const lifPrice = parseFloat(document.getElementById('us1-lif-price').value);
            const alPrice = parseFloat(document.getElementById('us1-al-price').value);
            const cuPrice = parseFloat(document.getElementById('us1-cu-price').value);
            
            // Get feed composition
            const niContent = parseFloat(document.getElementById('us1-ni-content').value) / 100;
            const coContent = parseFloat(document.getElementById('us1-co-content').value) / 100;
            const liContent = parseFloat(document.getElementById('us1-li-content').value) / 100;
            const cContent = parseFloat(document.getElementById('us1-c-content').value) / 100;
            const fContent = parseFloat(document.getElementById('us1-f-content').value) / 100;
            const alContent = parseFloat(document.getElementById('us1-al-content').value) / 100;
            const cuContent = parseFloat(document.getElementById('us1-cu-content').value) / 100;
            
            // Get commercial terms
            const volume = parseFloat(document.getElementById('us1-volume').value);
            const exportPayability = parseFloat(document.getElementById('us1-export-payability').value) / 100;
            const exportTransport = parseFloat(document.getElementById('us1-export-transport').value);
            const greenlibPayability = parseFloat(document.getElementById('us1-greenlib-payability').value) / 100;
            const processingFee = parseFloat(document.getElementById('us1-processing-fee').value);
            const capacityFee = parseFloat(document.getElementById('us1-capacity-fee').value);
            const transport = parseFloat(document.getElementById('us1-transport').value);
            
            // Get recovery rates
            const nicoRecovery = parseFloat(document.getElementById('us1-nico-recovery').value) / 100;
            const liRecovery = parseFloat(document.getElementById('us1-li-recovery').value) / 100;
            const cRecovery = parseFloat(document.getElementById('us1-c-recovery').value) / 100;
            const fRecovery = parseFloat(document.getElementById('us1-f-recovery').value) / 100;
            const alcuRecovery = parseFloat(document.getElementById('us1-alcu-recovery').value) / 100;
            
            // Get tariff info
            const cusma = document.getElementById('us1-cusma').value;
            const tariffRate = parseFloat(document.getElementById('us1-tariff-rate').value) / 100;
            const basel = parseFloat(document.getElementById('us1-basel').value);
            
            // Conversion factors
            const liToLi2CO3 = 5.32;
            const fToLiF = 1.365;
            
            // GREENLIB ROUTE
            const greenlibNiValue = niContent * nicoRecovery * greenlibPayability * niPrice;
            const greenlibCoValue = coContent * nicoRecovery * greenlibPayability * coPrice;
            const greenlibLiValue = liContent * liRecovery * liToLi2CO3 * liPrice;
            const greenlibGraphiteValue = cContent * cRecovery * graphitePrice;
            const greenlibLiFValue = fContent * fRecovery * fToLiF * lifPrice;
            const greenlibAlValue = alContent * alcuRecovery * alPrice;
            const greenlibCuValue = cuContent * alcuRecovery * cuPrice;
            
            const greenlibGrossValue = greenlibNiValue + greenlibCoValue + greenlibLiValue + 
                                      greenlibGraphiteValue + greenlibLiFValue + greenlibAlValue + greenlibCuValue;
            
            const tariffCost = cusma === 'no' ? greenlibGrossValue * tariffRate : 0;
            const greenlibNet = greenlibGrossValue - processingFee - capacityFee - transport - basel - tariffCost;
            
            // EXPORT ROUTE
            const exportNiValue = niContent * exportPayability * niPrice;
            const exportCoValue = coContent * exportPayability * coPrice;
            const exportNet = exportNiValue + exportCoValue - exportTransport;
            
            const improvement = greenlibNet - exportNet;
            const totalImprovement = improvement * volume;
            
            const cusmaStatus = cusma === 'yes' ? 
                '<span style="color: #16a34a;">✓ CUSMA Qualified - No Tariff</span>' : 
                '<span style="color: #dc2626;">✗ Not CUSMA Qualified - ' + (tariffRate * 100).toFixed(0) + '% Tariff Applies</span>';
            
            const resultsHTML = `
                <div class="info-box ${cusma === 'no' ? 'warning' : ''}">
                    <h4>CUSMA Status: ${cusmaStatus}</h4>
                    <p>${cusma === 'yes' ? 
                        'Products qualify as CUSMA-originating goods. Zero tariff on re-import to US.' : 
                        'Products do not meet CUSMA qualification. Tariff cost: ' + formatCurrency(tariffCost) + '/tonne'}</p>
                </div>
                
                <div class="comparison-cards">
                    <div class="result-card">
                        <h3>GreenLIB Canada Processing</h3>
                        <div class="metric">
                            <span class="metric-label">Ni/Co Value</span>
                            <span class="metric-value">${formatCurrency(greenlibNiValue + greenlibCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Li₂CO₃ Value</span>
                            <span class="metric-value">${formatCurrency(greenlibLiValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Graphite + Other Metals</span>
                            <span class="metric-value">${formatCurrency(greenlibGraphiteValue + greenlibLiFValue + greenlibAlValue + greenlibCuValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Gross Value</span>
                            <span class="metric-value">${formatCurrency(greenlibGrossValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">US Import Tariff</span>
                            <span class="metric-value">-${formatCurrency(tariffCost)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Processing & Capacity</span>
                            <span class="metric-value">-${formatCurrency(processingFee + capacityFee)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Transport & Basel</span>
                            <span class="metric-value">-${formatCurrency(transport + basel)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">NET REALIZATION</span>
                            <span class="metric-value">${formatCurrency(greenlibNet)}/t</span>
                        </div>
                    </div>
                    
                    <div class="result-card export">
                        <h3>Export to Asia</h3>
                        <div class="metric">
                            <span class="metric-label">Ni/Co Value (${(exportPayability * 100).toFixed(0)}%)</span>
                            <span class="metric-value">${formatCurrency(exportNiValue + exportCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Li Value</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Other Metals</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Gross Value</span>
                            <span class="metric-value">${formatCurrency(exportNiValue + exportCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Ocean Freight</span>
                            <span class="metric-value">-${formatCurrency(exportTransport)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">NET REALIZATION</span>
                            <span class="metric-value">${formatCurrency(exportNet)}/t</span>
                        </div>
                    </div>
                </div>
                
                ${improvement > 0 ? `
                    <div class="savings-highlight">
                        <h2>Value Enhancement with GreenLIB</h2>
                        <div class="amount">${formatCurrency(improvement)} per tonne</div>
                        <p>Total Annual Benefit: <strong>${formatCurrency(totalImprovement)}</strong> (${volume.toLocaleString()} tonnes)</p>
                    </div>
                ` : `
                    <div style="background: #fee2e2; color: #991b1b; padding: 20px; border-radius: 8px; text-align: center;">
                        <h3>⚠️ Tariff Impact Analysis</h3>
                        <p>Non-CUSMA qualification creates penalty of <strong>${formatCurrency(Math.abs(improvement))} per tonne</strong></p>
                        <p><strong>Action:</strong> Pursue CUSMA qualification or consider Scenario 2 (Sell in Canada)</p>
                    </div>
                `}
            `;
            
            document.getElementById('us1-results').innerHTML = resultsHTML;
            document.getElementById('us1-results').classList.add('show');
        }
        
        function calculateUS2() {
            // Get all commodity prices
            const niPrice = parseFloat(document.getElementById('us2-ni-price').value);
            const coPrice = parseFloat(document.getElementById('us2-co-price').value);
            const liPrice = parseFloat(document.getElementById('us2-li-price').value);
            const graphitePrice = parseFloat(document.getElementById('us2-graphite-price').value);
            const lifPrice = parseFloat(document.getElementById('us2-lif-price').value);
            const alPrice = parseFloat(document.getElementById('us2-al-price').value);
            const cuPrice = parseFloat(document.getElementById('us2-cu-price').value);
            
            // Get feed composition
            const niContent = parseFloat(document.getElementById('us2-ni-content').value) / 100;
            const coContent = parseFloat(document.getElementById('us2-co-content').value) / 100;
            const liContent = parseFloat(document.getElementById('us2-li-content').value) / 100;
            const cContent = parseFloat(document.getElementById('us2-c-content').value) / 100;
            const fContent = parseFloat(document.getElementById('us2-f-content').value) / 100;
            const alContent = parseFloat(document.getElementById('us2-al-content').value) / 100;
            const cuContent = parseFloat(document.getElementById('us2-cu-content').value) / 100;
            
            // Get commercial terms
            const volume = parseFloat(document.getElementById('us2-volume').value);
            const greenlibPayability = parseFloat(document.getElementById('us2-greenlib-payability').value) / 100;
            const processingFee = parseFloat(document.getElementById('us2-processing-fee').value);
            const capacityFee = parseFloat(document.getElementById('us2-capacity-fee').value);
            const profitSharePct = parseFloat(document.getElementById('us2-profit-share').value) / 100;
            const transport = parseFloat(document.getElementById('us2-transport').value);
            const basel = parseFloat(document.getElementById('us2-basel').value);
            
            // Get recovery rates
            const nicoRecovery = parseFloat(document.getElementById('us2-nico-recovery').value) / 100;
            const liRecovery = parseFloat(document.getElementById('us2-li-recovery').value) / 100;
            const cRecovery = parseFloat(document.getElementById('us2-c-recovery').value) / 100;
            const fRecovery = parseFloat(document.getElementById('us2-f-recovery').value) / 100;
            const alcuRecovery = parseFloat(document.getElementById('us2-alcu-recovery').value) / 100;
            
            // Get export alternative
            const exportPayability = parseFloat(document.getElementById('us2-export-payability').value) / 100;
            const exportTransport = parseFloat(document.getElementById('us2-export-transport').value);
            
            // Conversion factors
            const liToLi2CO3 = 5.32;
            const fToLiF = 1.365;
            
            // GREENLIB ROUTE (All metals at high payability)
            const greenlibNiValue = niContent * nicoRecovery * greenlibPayability * niPrice;
            const greenlibCoValue = coContent * nicoRecovery * greenlibPayability * coPrice;
            const greenlibLiValue = liContent * liRecovery * liToLi2CO3 * liPrice;
            const greenlibGraphiteValue = cContent * cRecovery * graphitePrice;
            const greenlibLiFValue = fContent * fRecovery * fToLiF * lifPrice;
            const greenlibAlValue = alContent * alcuRecovery * alPrice;
            const greenlibCuValue = cuContent * alcuRecovery * cuPrice;
            
            const greenlibGrossValue = greenlibNiValue + greenlibCoValue + greenlibLiValue + 
                                      greenlibGraphiteValue + greenlibLiFValue + greenlibAlValue + greenlibCuValue;
            
            // Calculate net margin after all costs
            const totalCosts = processingFee + capacityFee + transport + basel;
            const netMargin = greenlibGrossValue - totalCosts;
            
            // Profit sharing: Customer receives their % of the net margin
            const customerProfitShare = netMargin * profitSharePct;
            const greenlibShare = netMargin * (1 - profitSharePct);
            
            // EXPORT ROUTE (Ni/Co only at limited payability)
            const exportNiValue = niContent * exportPayability * niPrice;
            const exportCoValue = coContent * exportPayability * coPrice;
            const exportNet = exportNiValue + exportCoValue - exportTransport;
            
            const improvement = customerProfitShare - exportNet;
            const totalImprovement = improvement * volume;
            const totalProfitShare = customerProfitShare * volume;
            
            const resultsHTML = `
                <div class="info-box">
                    <h4>✓ Zero Tariff Exposure - Domestic Canadian Sales</h4>
                    <p>Materials sold to Canadian refineries. US customer receives ${(profitSharePct * 100).toFixed(0)}% of net margin (${formatCurrency(customerProfitShare)}/t). GreenLIB receives ${((1 - profitSharePct) * 100).toFixed(0)}% (${formatCurrency(greenlibShare)}/t). Export route pays 55-70% on Ni/Co only. GreenLIB pays 90% on Ni/Co and recovers all other metals currently lost in export routes. No tariff risk.</p>
                </div>
                
                <div class="comparison-cards">
                    <div class="result-card">
                        <h3>GreenLIB Profit-Sharing</h3>
                        <div class="metric">
                            <span class="metric-label">Ni/Co Value (${(nicoRecovery * 100).toFixed(0)}% × ${(greenlibPayability * 100).toFixed(0)}%)</span>
                            <span class="metric-value">${formatCurrency(greenlibNiValue + greenlibCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Li₂CO₃ Value (${(liRecovery * 100).toFixed(0)}% rec)</span>
                            <span class="metric-value">${formatCurrency(greenlibLiValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Graphite Value (${(cRecovery * 100).toFixed(0)}% rec)</span>
                            <span class="metric-value">${formatCurrency(greenlibGraphiteValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">LiF Value (${(fRecovery * 100).toFixed(0)}% rec)</span>
                            <span class="metric-value">${formatCurrency(greenlibLiFValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Al/Cu Value (${(alcuRecovery * 100).toFixed(0)}% rec)</span>
                            <span class="metric-value">${formatCurrency(greenlibAlValue + greenlibCuValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Gross Product Value</span>
                            <span class="metric-value">${formatCurrency(greenlibGrossValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Processing & Capacity Fees</span>
                            <span class="metric-value">-${formatCurrency(processingFee + capacityFee)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Transport & Basel</span>
                            <span class="metric-value">-${formatCurrency(transport + basel)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Net Margin</span>
                            <span class="metric-value">${formatCurrency(netMargin)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">US Customer Share (${(profitSharePct * 100).toFixed(0)}%)</span>
                            <span class="metric-value">+${formatCurrency(customerProfitShare)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">GreenLIB Share (${((1 - profitSharePct) * 100).toFixed(0)}%)</span>
                            <span class="metric-value">+${formatCurrency(greenlibShare)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">US Tariff</span>
                            <span class="metric-value">$0.00 (None)</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">CUSTOMER NET</span>
                            <span class="metric-value">${formatCurrency(customerProfitShare)}/t</span>
                        </div>
                    </div>
                    
                    <div class="result-card export">
                        <h3>Export to Asia</h3>
                        <div class="metric">
                            <span class="metric-label">Ni Value (${(exportPayability * 100).toFixed(0)}% payability)</span>
                            <span class="metric-value">${formatCurrency(exportNiValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Co Value (${(exportPayability * 100).toFixed(0)}% payability)</span>
                            <span class="metric-value">${formatCurrency(exportCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Li₂CO₃ Value</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Graphite Value</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">LiF Value</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Al/Cu Value</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Gross Product Value</span>
                            <span class="metric-value">${formatCurrency(exportNiValue + exportCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Ocean Freight (CIF Busan)</span>
                            <span class="metric-value">-${formatCurrency(exportTransport)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">NET REALIZATION</span>
                            <span class="metric-value">${formatCurrency(exportNet)}/t</span>
                        </div>
                    </div>
                </div>
                
                <div class="savings-highlight">
                    <h2>Enhanced Value with GreenLIB</h2>
                    <div class="amount">${formatCurrency(improvement)} per tonne</div>
                    <p>Total Annual Benefit to US Customer: <strong>${formatCurrency(totalImprovement)}</strong> (${volume.toLocaleString()} tonnes)</p>
                    <p>Customer Receives (${(profitSharePct * 100).toFixed(0)}% profit share): <strong>${formatCurrency(totalProfitShare)}</strong> annually</p>
                    <p>GreenLIB Receives (${((1 - profitSharePct) * 100).toFixed(0)}% profit share): <strong>${formatCurrency(greenlibShare * volume)}</strong> annually</p>
                </div>
            `;
            
            document.getElementById('us2-results').innerHTML = resultsHTML;
            document.getElementById('us2-results').classList.add('show');
        }
        
        function calculateEU() {
            // Get all commodity prices
            const niPrice = parseFloat(document.getElementById('eu-ni-price').value);
            const coPrice = parseFloat(document.getElementById('eu-co-price').value);
            const liPrice = parseFloat(document.getElementById('eu-li-price').value);
            const graphitePrice = parseFloat(document.getElementById('eu-graphite-price').value);
            const lifPrice = parseFloat(document.getElementById('eu-lif-price').value);
            const alPrice = parseFloat(document.getElementById('eu-al-price').value);
            const cuPrice = parseFloat(document.getElementById('eu-cu-price').value);
            
            // Get feed composition
            const niContent = parseFloat(document.getElementById('eu-ni-content').value) / 100;
            const coContent = parseFloat(document.getElementById('eu-co-content').value) / 100;
            const liContent = parseFloat(document.getElementById('eu-li-content').value) / 100;
            const cContent = parseFloat(document.getElementById('eu-c-content').value) / 100;
            const fContent = parseFloat(document.getElementById('eu-f-content').value) / 100;
            const alContent = parseFloat(document.getElementById('eu-al-content').value) / 100;
            const cuContent = parseFloat(document.getElementById('eu-cu-content').value) / 100;
            
            // Get commercial terms
            const volume = parseFloat(document.getElementById('eu-volume').value);
            const exportPayability = parseFloat(document.getElementById('eu-export-payability').value) / 100;
            const exportTransport = parseFloat(document.getElementById('eu-export-transport').value);
            const greenlibPayability = parseFloat(document.getElementById('eu-greenlib-payability').value) / 100;
            const processingFee = parseFloat(document.getElementById('eu-processing-fee').value);
            const capacityFee = parseFloat(document.getElementById('eu-capacity-fee').value);
            const greenlibTransport = parseFloat(document.getElementById('eu-greenlib-transport').value);
            const basel = parseFloat(document.getElementById('eu-basel').value);
            
            // Get recovery rates
            const nicoRecovery = parseFloat(document.getElementById('eu-nico-recovery').value) / 100;
            const liRecovery = parseFloat(document.getElementById('eu-li-recovery').value) / 100;
            const cRecovery = parseFloat(document.getElementById('eu-c-recovery').value) / 100;
            const fRecovery = parseFloat(document.getElementById('eu-f-recovery').value) / 100;
            const alcuRecovery = parseFloat(document.getElementById('eu-alcu-recovery').value) / 100;
            
            // Conversion factors
            const liToLi2CO3 = 5.32;
            const fToLiF = 1.365;
            
            // EXPORT ROUTE
            const exportNiValue = niContent * exportPayability * niPrice;
            const exportCoValue = coContent * exportPayability * coPrice;
            const exportNet = exportNiValue + exportCoValue - exportTransport;
            
            // GREENLIB ROUTE
            const greenlibNiValue = niContent * nicoRecovery * greenlibPayability * niPrice;
            const greenlibCoValue = coContent * nicoRecovery * greenlibPayability * coPrice;
            const greenlibLiValue = liContent * liRecovery * liToLi2CO3 * liPrice;
            const greenlibGraphiteValue = cContent * cRecovery * graphitePrice;
            const greenlibLiFValue = fContent * fRecovery * fToLiF * lifPrice;
            const greenlibAlValue = alContent * alcuRecovery * alPrice;
            const greenlibCuValue = cuContent * alcuRecovery * cuPrice;
            
            const greenlibGrossValue = greenlibNiValue + greenlibCoValue + greenlibLiValue + 
                                      greenlibGraphiteValue + greenlibLiFValue + greenlibAlValue + greenlibCuValue;
            const greenlibNet = greenlibGrossValue - processingFee - capacityFee - greenlibTransport - basel;
            
            const improvement = greenlibNet - exportNet;
            const improvementPct = (improvement / exportNet) * 100;
            const totalImprovement = improvement * volume;
            
            const resultsHTML = `
                <div class="info-box">
                    <h4>✓ CETA Zero-Tariff Access + Full Metal Recovery</h4>
                    <p>Export route captures 55-70% of Ni/Co only. GreenLIB captures 90% of Ni/Co and recovers all other metals (Li, Graphite, F, Al, Cu) currently lost in export routes.</p>
                </div>
                
                <div class="comparison-cards">
                    <div class="result-card">
                        <h3>GreenLIB Processing</h3>
                        <div class="metric">
                            <span class="metric-label">Ni/Co Value</span>
                            <span class="metric-value">${formatCurrency(greenlibNiValue + greenlibCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Li₂CO₃ Value</span>
                            <span class="metric-value">${formatCurrency(greenlibLiValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Graphite Value</span>
                            <span class="metric-value">${formatCurrency(greenlibGraphiteValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">LiF + Al/Cu</span>
                            <span class="metric-value">${formatCurrency(greenlibLiFValue + greenlibAlValue + greenlibCuValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Gross Value</span>
                            <span class="metric-value">${formatCurrency(greenlibGrossValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Processing & Capacity</span>
                            <span class="metric-value">-${formatCurrency(processingFee + capacityFee)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Transport + Basel</span>
                            <span class="metric-value">-${formatCurrency(greenlibTransport + basel)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">NET REALIZATION</span>
                            <span class="metric-value">${formatCurrency(greenlibNet)}/t</span>
                        </div>
                    </div>
                    
                    <div class="result-card export">
                        <h3>Export Route</h3>
                        <div class="metric">
                            <span class="metric-label">Ni/Co Value (${(exportPayability * 100).toFixed(0)}%)</span>
                            <span class="metric-value">${formatCurrency(exportNiValue + exportCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Li₂CO₃ Value</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Other Metals</span>
                            <span class="metric-value">$0.00/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Gross Value</span>
                            <span class="metric-value">${formatCurrency(exportNiValue + exportCoValue)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Transport (CIF Busan)</span>
                            <span class="metric-value">-${formatCurrency(exportTransport)}/t</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">NET REALIZATION</span>
                            <span class="metric-value">${formatCurrency(exportNet)}/t</span>
                        </div>
                    </div>
                </div>
                
                <div class="savings-highlight">
                    <h2>Value Enhancement with GreenLIB</h2>
                    <div class="amount">${formatCurrency(improvement)} per tonne</div>
                    <p>Total Annual Benefit: <strong>${formatCurrency(totalImprovement)}</strong> (${volume.toLocaleString()} tonnes)</p>
                    <p>Improvement: <strong>${improvementPct.toFixed(1)}%</strong></p>
                </div>
            `;
            
            document.getElementById('eu-results').innerHTML = resultsHTML;
            document.getElementById('eu-results').classList.add('show');
        }
    </script>
</body>
</html>
